# 1Panel在线图书销售系统部署指南

## 服务器信息
- **服务器IP**: 192.168.122.131
- **1Panel地址**: http://192.168.122.131:32435/e98e481bc4
- **用户名**: 18202786f9
- **密码**: 19f317d806

## 第一步：检查Docker环境

1. **登录1panel管理界面**
   - 访问: http://192.168.122.131:32435/e98e481bc4
   - 输入用户名和密码

2. **检查Docker服务**
   - 点击左侧菜单"容器管理"
   - 确认Docker服务正常运行
   - 如果没有安装Docker，点击"安装Docker"

## 第二步：上传项目文件

### 方法A：通过1panel文件管理器
1. 点击左侧菜单"文件管理"
2. 创建目录：`/opt/bookstore`
3. 进入该目录，上传所有项目文件

### 方法B：通过SSH上传（推荐）
```bash
# 在本地执行，上传项目文件
scp -r D:\AAA\* root@192.168.122.131:/opt/bookstore/
```

## 第三步：配置防火墙和安全组

### 在云服务器控制台开放端口：
- **80** - HTTP前端访问
- **443** - HTTPS访问（推荐）
- **8081** - 后端API访问
- **3306** - MySQL数据库（可选，仅内部访问）

### 在1panel中配置防火墙：
1. 进入"安全" → "防火墙"
2. 添加规则：
   - 端口：80，协议：TCP，动作：允许
   - 端口：443，协议：TCP，动作：允许
   - 端口：8081，协议：TCP，动作：允许

## 第四步：执行部署

### 通过1panel终端执行：
1. 点击左侧菜单"终端"
2. 执行以下命令：

```bash
# 进入项目目录
cd /opt/bookstore

# 设置脚本权限
chmod +x deploy.sh
chmod +x backup.sh

# 执行部署
./deploy.sh
```

### 或者通过SSH连接执行：
```bash
# 连接到服务器
ssh root@192.168.122.131

# 进入项目目录并部署
cd /opt/bookstore
./deploy.sh
```

## 第五步：配置域名和SSL（可选）

### 在1panel中配置网站：
1. 点击"网站管理" → "网站"
2. 点击"新建网站"
3. 配置信息：
   - 域名：您的域名（如：bookstore.yourdomain.com）
   - 根目录：`/opt/bookstore/Sofeware_Demo/dist`
   - 端口：80
4. 启用SSL证书（推荐）

### 配置反向代理：
1. 点击"网站管理" → "反向代理"
2. 添加代理规则：
   - 域名：您的域名
   - 目标地址：`http://localhost:80`
   - 启用SSL

## 第六步：验证部署

### 检查服务状态：
```bash
# 查看容器状态
docker-compose ps

# 查看服务日志
docker-compose logs -f
```

### 访问测试：
- **前端**: http://192.168.122.131:80
- **后端API**: http://192.168.122.131:8081
- **1Panel管理**: http://192.168.122.131:32435/e98e481bc4

## 第七步：配置监控和备份

### 在1panel中启用监控：
1. 进入"监控" → "系统监控"
2. 启用CPU、内存、磁盘监控
3. 设置告警阈值

### 配置自动备份：
1. 进入"计划任务"
2. 添加定时任务：
   ```bash
   # 每日凌晨2点备份
   0 2 * * * /opt/bookstore/backup.sh
   ```

## 故障排除

### 常见问题：

1. **容器启动失败**
   ```bash
   # 查看详细日志
   docker-compose logs [service_name]
   
   # 检查端口占用
   netstat -tulpn | grep :8081
   ```

2. **数据库连接失败**
   ```bash
   # 检查MySQL容器
   docker-compose exec mysql mysql -u root -p
   ```

3. **前端无法访问**
   - 检查防火墙设置
   - 确认端口80已开放
   - 查看nginx日志

### 性能优化：

1. **在1panel中配置资源限制**
   - 进入"容器管理"
   - 为每个容器设置内存和CPU限制

2. **启用缓存**
   - 配置Redis缓存（可选）
   - 启用Nginx静态文件缓存

## 安全建议

1. **更改默认密码**
   - 修改MySQL root密码
   - 更改JWT密钥
   - 修改1panel默认密码

2. **定期更新**
   - 更新系统补丁
   - 更新Docker镜像
   - 更新应用代码

3. **监控访问日志**
   - 在1panel中查看访问日志
   - 设置异常访问告警

## 联系支持

如遇到问题，可以：
1. 查看1panel官方文档：https://1panel.cn/docs
2. 访问官方论坛：https://bbs.fit2cloud.com/c/1p/7
3. 检查系统日志和容器日志 